var bm = [
	[
	//   0  1  2  3  4  5  6  7  8  9  10
		[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],//0
		[0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0],//1
		[0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0],//2
		[0, 0, 0, 1, 0, 0, 1, 1, 0, 0, 0],//3
		[0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0],//4
		[0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0],//5
		[0, 0, 0, 1, 1, 0, 0, 1, 0, 0, 0],//6
		[0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0],//7
		[0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0],//8
		[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0] //9
	],
	[
	//   0  1  2  3  4  5  6  7  8  9  10
		[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],//0
		[0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0],//1
		[0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0],//2
		[0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0],//3
		[0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0],//4
		[0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0],//5
		[0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0],//6
		[0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0],//7
		[0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0],//8
		[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0] //9
	],
	[
	//   0  1  2  3  4  5  6  7  8  9  10
		[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],//0
		[0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0],//1
		[0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0],//2
		[0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0],//3
		[0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0],//4
		[0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0],//5
		[0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0],//6
		[0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0],//7
		[0, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0],//8
		[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0] //9
	],
	[
	//   0  1  2  3  4  5  6  7  8  9  10
		[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],//0
		[0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0],//1
		[0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0],//2
		[0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0],//3
		[0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0],//4
		[0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0],//5
		[0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0],//6
		[0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0],//7
		[0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0],//8
		[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0] //9
	],
	[
	//   0  1  2  3  4  5  6  7  8  9  10
		[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],//0
		[0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0],//1
		[0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0],//2
		[0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0],//3
		[0, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0],//4
		[0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0],//5
		[0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0],//6
		[0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0],//7
		[0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0],//8
		[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0] //9
	],
	[
	//   0  1  2  3  4  5  6  7  8  9  10
		[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],//0
		[0, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0],//1
		[0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0],//2
		[0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0],//3
		[0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0],//4
		[0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0],//5
		[0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0],//6
		[0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0],//7
		[0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0],//8
		[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0] //9
	],
	[
	//   0  1  2  3  4  5  6  7  8  9  10
		[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],//0
		[0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0],//1
		[0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0],//2
		[0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0],//3
		[0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0],//4
		[0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0],//5
		[0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0],//6
		[0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0],//7
		[0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0],//8
		[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0] //9
	],
	[
	//   0  1  2  3  4  5  6  7  8  9  10
		[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],//0
		[0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0],//1
		[0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0],//2
		[0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0],//3
		[0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0],//4
		[0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0],//5
		[0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0],//6
		[0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0],//7
		[0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0],//8
		[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0] //9
	],
	[
	//   0  1  2  3  4  5  6  7  8  9  10
		[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],//0
		[0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0],//1
		[0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0],//2
		[0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0],//3
		[0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0],//4
		[0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0],//5
		[0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0],//6
		[0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0],//7
		[0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0],//8
		[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0] //9
	],
	[
	//   0  1  2  3  4  5  6  7  8  9  10
		[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],//0
		[0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0],//1
		[0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0],//2
		[0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0],//3
		[0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0],//4
		[0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0],//5
		[0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0],//6
		[0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0],//7
		[0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0],//8
		[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0] //9
	]
];
var Qlock = {
	rows:0,
	cols:0,
	parent:null,
	tmr:null,
	board:[
		//0   1   2   3   4   5   6   7   8   9  10
		['E','S','K','I','S','T','A','F','Ü','N','F'],//0
		['Z','E','H','N','Z','W','A','N','Z','I','G'],//1
		['D','R','E','I','V','I','E','R','T','E','L'],//2
		['V','O','R','B','I','E','R','N','A','C','H'],//3
		['H','A','L','B','A','E','L','F','Ü','N','F'],//4
		['E','I','N','S','U','M','T','Z','W','E','I'],//5
		['D','R','E','I','P','R','J','A','C','H','T'],//6
		['S','E','C','H','S','W','L','V','I','E','R'],//7
		['S','I','E','B','E','N','Z','W','Ö','L','F'],//8
		['Z','E','H','N','E','U','N','K','U','H','R'] //9
	],
	special:{
		'es'  :[0,0,2],
		'ist' :[0,3,3],
		'bier':[3,3,4],
		'um'  :[5,4,2],
		'uhr' :[9,8,3],
		'vor' :[3,0,3],
		'nach':[3,7,4],
		'ein' :[5,0,3]
	},
	hours:{
		 0:[8,6,5],
		 1:[5,0,4],
		 2:[5,7,4],
		 3:[6,0,4],
		 4:[7,7,4],
		 5:[4,7,4],
		 6:[7,0,5],
		 7:[8,0,6],
		 8:[6,7,4],
		 9:[9,3,4],
		10:[9,0,4],
		11:[4,5,3],
		12:[8,6,5]
	},
	minutes_:{
		 5:[0,7,4],
		10:[1,0,4],
		15:[2,4,7],
		20:[1,4,7],
		30:[4,0,4],
		45:[2,0,11]
	},
	minutes:{
		 0:['uhr'],
		 5:[ 5, 'nach'],
		10:[10, 'nach'],
		15:[15],         // alt.: [15, 'nach']
		20:[20, 'nach'], // alt.: [10, 'vor', 30]
		25:[ 5, 'vor', 30],
		30:[30],
		35:[ 5, 'nach', 30],
		40:[20, 'vor'],  // alt.: [10, 'nach', 30]
		45:[45],
		50:[10, 'vor'],
		55:[ 5, 'vor'],
		60:['uhr']
	},
	drawBoard : function(e) {
		this.parent=e;
		for (var row=0; row<this.rows; row++) {
			var rid='r'+row+'c';
			for (var col=0; col<this.cols; col++) {
				var id=rid+col;
				e.append('<div id="'+id+'">'+this.board[row][col]+'</div>');
			}
			e.append('<br class="clr" />');
		}
		return this;
	},
	clear : function() {
		this.parent.children('div').removeClass('active');
	},
	activateSpecial : function(x) {
		return this.activateWord(this.special[x]);
	},
	activateHour : function(x) {
		return this.activateWord(this.hours[x]);
	},
	activateMinutes : function(x) {
		var pos_=this.minutes[x];
		for (var i=0; i<pos_.length; i++) {
			if (typeof pos_[i] === 'string') {
				this.activateWord(this.special[ pos_[i] ]);
			}
			if (typeof pos_[i] === 'number') {
				this.activateWord(this.minutes_[ pos_[i] ]);
			}
		}
		return this;
	},
	activateWord : function(pos) {
		var r=pos[0];
		var c=pos[1];
		var len=pos[2];
		var rid='r'+r+'c';
		for (; len>0; --len) {
			var id=rid+(c+len-1);
			$('#'+id).addClass('active');
		}
		return this;
	},
	showTime : function(hours, minutes) {
		//var m_=minutes+Math.floor((s+2.5*60)/60); // rounding by 2.5 min
		var m5 = minutes - (minutes % 5);
		var h12 = (hours + 1) % 12;
		// special case: do not show next hour
		if (0 == m5 || 5 == m5 || 10 == m5 || 20 == m5) {
			h12=hours % 12;
		}

		this.clear();
		this.activateSpecial('es');
		this.activateSpecial('ist');
		// special case: EIN UHR instead of EINS UHR
		if (0 == m5 && 1 == h12) {
			this.activateSpecial('ein');
		} else {
			this.activateHour(h12);
		}
		this.activateMinutes(m5);

		return this;
	},
	showBitmap : function(b) {
		var rows = b.length, cols = b[0].length;
		if (10 != rows || 11 != cols) {
			return this;
		}
		this.clear();
		for (var r=0; r<rows; ++r) {
			var rid='r'+r+'c';
			for (var c=0; c<cols; ++c) {
				if (1 == b[r][c]) {
					var id=rid+c;
					$('#'+id).addClass('active');
				}
			}
		}
		return this;
	},
	showBierUmVier : function() {
		this.clear();
		this.activateSpecial('bier');
		this.activateSpecial('um');
		this.activateHour(4);
		return this;
	},
	update : function() {
		var dt=new Date();
		var d=dt.getDay();
		var h=dt.getHours();
		var m=dt.getMinutes();
		var s=dt.getSeconds();

		// special case: BIER UM VIER
		if (5 == d && h >= 16) {
			return this.showBierUmVier();
		}
		
		// special case: COUNTDOWN
		if (59 == m && s > 50) {
			return this.showBitmap(bm[10 - (s-50)]);
		}
		
		// regular display
		return this.showTime(h, m);
	},
	init : function(e) {
		this.rows=this.board.length;
		this.cols=this.board[0].length;
		this.drawBoard(e);
		this.update();

		var that=this;
		var updater = function() { that.update(); }
		this.tmr=setInterval(updater, 1000);

		return this;
	}
};